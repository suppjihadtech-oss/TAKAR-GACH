<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>টাকার গাছ | Takar Gach</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        /* ==================== ১. গ্লোবাল স্টাইল ও থিম ==================== */
        :root {
            --primary-green: #00693e;
            --gradient-header: linear-gradient(180deg, #00693e 0%, #004d2c 100%);
            --notice-gradient: linear-gradient(90deg, #f59e0b 0%, #ec4899 100%);
            --bg-color: #f7fcf9;
            --white: #ffffff;
            --danger: #dc2626;
            --success: #059669;
            --shadow: 0 8px 25px rgba(0, 0, 0, 0.06);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Hind Siliguri', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg-color); color: #333; height: 100vh; overflow: hidden; position: relative; }
        
        ::-webkit-scrollbar { width: 0px; background: transparent; }

        /* ==================== ২. স্মার্ট টোস্ট নোটিফিকেশন ==================== */
        #toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; width: 90%; max-width: 350px; }
        .toast { background: rgba(0,0,0,0.85); color: white; padding: 12px 20px; border-radius: 12px; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; font-size: 14px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); animation: toastIn 0.4s ease; backdrop-filter: blur(5px); }
        .toast.success { border-left: 5px solid var(--success); }
        .toast.error { border-left: 5px solid var(--danger); }

        /* ==================== ৩. অথেন্টিকেশন ও নম্বর ক্যাপচা ==================== */
        #auth-section { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--gradient-header); z-index: 5000; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .auth-card { background: var(--white); width: 100%; max-width: 380px; padding: 30px; border-radius: 25px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.3); animation: slideUp 0.5s ease; }
        .auth-input { width: 100%; padding: 14px; margin-bottom: 12px; border: 1px solid #eee; border-radius: 12px; font-size: 15px; outline: none; background: #fafafa; }
        .captcha-box { display: flex; align-items: center; justify-content: space-between; background: #f0f0f0; padding: 10px; border-radius: 12px; margin-bottom: 15px; border: 1px dashed #ccc; }
        #captcha-code { font-weight: bold; font-size: 22px; letter-spacing: 5px; color: var(--primary-green); }

        /* ==================== ৪. মিনি বাটন ও কার্ভড হেডার ==================== */
        .app-header { background: var(--gradient-header); padding: 20px 20px 75px 20px; border-bottom-left-radius: 40px; border-bottom-right-radius: 40px; color: white; position: relative; z-index: 100; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .avatar-box { width: 50px; height: 50px; border-radius: 50%; border: 2px solid white; overflow: hidden; background: #eee; }
        .avatar-box img { width: 100%; height: 100%; object-fit: cover; }
        
        /* পিল ব্যালেন্স বাটন */
        .balance-pill { background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); padding: 10px 25px; border-radius: 50px; text-align: center; cursor: pointer; width: 190px; margin: 0 auto; border: 1px solid rgba(255,255,255,0.2); }
        .bal-lab { font-size: 14px; font-weight: 500; }
        .bal-val { font-size: 20px; font-weight: 700; display: none; }

        /* মিনি অ্যাকশন গ্রিড */
        .action-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: -35px; position: relative; z-index: 200; }
        .action-card { background: var(--white); border-radius: 18px; padding: 15px 5px; text-align: center; box-shadow: var(--shadow); cursor: pointer; transition: 0.2s; }
        .action-card i { font-size: 20px; margin-bottom: 5px; display: block; }
        .action-card span { font-size: 10px; font-weight: 700; color: #444; }

        /* গ্রাডিয়েন্ট নোটিশ */
        .notice-pill { background: var(--notice-gradient); margin-top: 20px; padding: 12px 15px; border-radius: 15px; color: white; display: flex; align-items: center; gap: 10px; font-size: 12px; font-weight: 500; box-shadow: 0 5px 15px rgba(236,72,153,0.15); }

        /* মিনি সার্ভিস কার্ডস */
        .service-title { margin-top: 20px; font-size: 16px; font-weight: 700; color: #333; border-left: 4px solid var(--primary-green); padding-left: 10px; }
        .service-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 12px; }
        .service-card { background: var(--white); border-radius: 18px; padding: 15px 8px; text-align: center; border: 1px solid #f0f0f0; cursor: pointer; }
        .service-card img { width: 32px; height: 32px; margin-bottom: 5px; }
        .service-card span { font-size: 11px; font-weight: 600; color: #555; }

        /* ==================== ৫. পেজ এলিমেন্টস ও হিস্টরি ==================== */
        #page-container { position: relative; width: 100%; height: calc(100vh - 160px); overflow: hidden; }
        .page { position: absolute; top: 0; left: 0; width: 100%; height: 100%; padding: 0 20px 100px 20px; transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1); opacity: 0; transform: translateX(100%); pointer-events: none; overflow-y: auto; }
        .page.active { opacity: 1; transform: translateX(0); pointer-events: all; }

        /* ==================== ৬. রিসিট পপ-আপ (Fixed & Professional) ==================== */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 6000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .receipt-card { background: var(--white); width: 90%; max-width: 380px; padding: 30px; border-radius: 25px; text-align: center; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .receipt-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed #eee; font-size: 14px; }

        /* ==================== ৭. বটম নেভিগেশন ==================== */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--white); display: flex; justify-content: space-around; padding: 15px 0; border-top-left-radius: 30px; border-top-right-radius: 30px; box-shadow: 0 -8px 25px rgba(0,0,0,0.05); z-index: 1000; }
        .nav-item { text-align: center; color: #ccc; cursor: pointer; width: 25%; transition: 0.3s; }
        .nav-item.active { color: var(--primary-green); font-weight: bold; }
        .nav-item i { font-size: 22px; margin-bottom: 4px; display: block; }
        .nav-item span { font-size: 11px; }

        @keyframes toastIn { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>

    <div id="toast-container"></div>

    <div id="auth-section">
        <div class="auth-card" id="signup-form">
            <h2 style="color:var(--primary-green); margin-bottom:10px;">টাকার গাছ</h2>
            <p style="margin-bottom:20px; font-size:13px; color:#777;">অ্যাকাউন্ট তৈরি করে আয় শুরু করুন</p>
            <input type="text" id="reg-name" class="auth-input" placeholder="আপনার নাম">
            <input type="number" id="reg-phone" class="auth-input" placeholder="মোবাইল নম্বর">
            <input type="email" id="reg-email" class="auth-input" placeholder="ইমেইল অ্যাড্রেস">
            <input type="password" id="reg-pass" class="auth-input" placeholder="পাসওয়ার্ড">
            <div class="captcha-box">
                <span id="captcha-code">0000</span>
                <input type="number" id="captcha-input" style="width:100px; padding:10px; border-radius:10px; border:none; text-align:center; font-weight:bold;" placeholder="কোড">
            </div>
            <button class="auth-btn" style="width:100%; padding:15px; background:var(--gradient-header); color:white; border:none; border-radius:12px; font-weight:bold;" onclick="handleSignup()">নিবন্ধন করুন</button>
            <p style="margin-top:15px; font-size:13px;">অ্যাকাউন্ট আছে? <span style="color:var(--primary-green); font-weight:bold; cursor:pointer;" onclick="toggleAuth('login')">লগইন</span></p>
        </div>
    </div>

    <div id="app-body" style="display:none;">
        <header class="app-header">
            <div class="header-top">
                <div style="display:flex; align-items:center; gap:12px;">
                    <div class="avatar-box"><img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png"></div>
                    <div>
                        <h4 id="h-user-name" style="font-size:15px;">User Name</h4>
                        <span id="h-user-phone" style="font-size:11px; opacity:0.8;">01XXXXXXXXX</span>
                    </div>
                </div>
                <div style="position:relative;" onclick="showToast('নতুন কোনো নোটিশ নেই!', 'success')">
                    <i class="far fa-bell" style="font-size:22px;"></i>
                    <div style="position:absolute; top:-3px; right:-3px; background:var(--danger); width:12px; height:12px; border-radius:50%; border:2px solid var(--primary-green);"></div>
                </div>
            </div>
            <div class="balance-pill" onclick="revealBalance()">
                <span id="bal-label" class="bal-lab">ব্যালেন্স দেখুন</span>
                <span id="bal-value" class="bal-val">৳ 0.00</span>
            </div>
        </header>

        <div id="page-container">
            <div id="home-page" class="page active">
                <div class="action-grid">
                    <div class="action-card" onclick="goToPage('deposit-page')"><i class="fas fa-plus-circle" style="color:#059669;"></i><span>ডিপোজিট</span></div>
                    <div class="action-card" onclick="goToPage('withdraw-page')"><i class="fas fa-arrow-circle-down" style="color:#dc2626;"></i><span>ক্যাশআউট</span></div>
                    <div class="action-card" onclick="goToPage('vip-page')"><i class="fas fa-crown" style="color:#f59e0b;"></i><span>ভিআইপি</span></div>
                    <div class="action-card" onclick="goToPage('task-page')"><i class="fas fa-list-check" style="color:#2563eb;"></i><span>কাজ</span></div>
                </div>

                <div class="notice-pill">
                    <i class="fas fa-bullhorn" style="font-size:16px;"></i>
                    <marquee behavior="scroll" direction="left">বিশেষ বিজ্ঞপ্তি: আমাদের অফিস সময় সকাল ৯টা থেকে রাত ৯:৩০ পর্যন্ত। ১০ জন রেফার করতে পারলে ২০ টাকা বোনাস!</marquee>
                </div>

                <h3 class="service-title">অন্যান্য সেবা</h3>
                <div class="service-grid">
                    <div class="service-card" onclick="claimDailyBonus()"><img src="https://cdn-icons-png.flaticon.com/512/2662/2662503.png"><br><span>ডেইলি বোনাস</span></div>
                    <div class="service-card" onclick="showToast('শীঘ্রই আসছে!', 'success')"><img src="https://cdn-icons-png.flaticon.com/512/1603/1603847.png"><br><span>সেরা ৭০</span></div>
                    <div class="service-card" onclick="showToast('শীঘ্রই আসছে!', 'success')"><img src="https://cdn-icons-png.flaticon.com/512/2534/2534204.png"><br><span>লাকি স্পিন</span></div>
                    <div class="service-card" onclick="showToast('শীঘ্রই আসছে!', 'success')"><img src="https://cdn-icons-png.flaticon.com/512/1603/1603847.png"><br><span>রিচার্জ</span></div>
                    <div class="service-card" onclick="showToast('শীঘ্রই আসছে!', 'success')"><img src="https://cdn-icons-png.flaticon.com/512/2534/2534204.png"><br><span>কুইজ খেলুন</span></div>
                    <div class="service-card" onclick="openSupport()"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111646.png"><br><span>সাপোর্ট</span></div>
                </div>
            </div>

            <div id="deposit-page" class="page">
                <h3 style="margin-bottom:15px; color:var(--primary-green);"><i class="fas fa-plus-circle"></i> ডিপোজিট রিকোয়েস্ট</h3>
                <div style="background:#e6f4ea; padding:15px; border-radius:15px; text-align:center; margin-bottom:15px;">
                    <span style="font-size:12px; color:#155724;">বিকাশ নম্বরটি কপি করে টাকা পাঠিয়ে TrxID দিন:</span><br>
                    <b style="font-size:20px; color:var(--primary-green);">01340975230</b>
                    <button onclick="copyToClipboard('01340975230')" style="display:block; margin:8px auto 0; background:var(--primary-green); color:white; border:none; padding:5px 15px; border-radius:8px; font-size:11px; font-weight:bold;">COPY NUMBER</button>
                </div>
                <input type="number" id="dep-amt" class="auth-input" placeholder="টাকার পরিমাণ (মিনিমাম ১০০৳)">
                <input type="text" id="dep-trx" class="auth-input" placeholder="ট্রানজেকশন আইডি (TrxID)">
                <button class="auth-btn" style="width:100%; padding:14px; background:var(--primary-green); color:white; border:none; border-radius:12px; font-weight:bold;" onclick="submitDeposit()">পেমেন্ট সাবমিট করুন</button>
            </div>
            
            <div id="withdraw-page" class="page"><h3>ক্যাশআউট সেকশন</h3><button onclick="goHome()">হোমে ফিরে যান</button></div>
            <div id="task-page" class="page"><h3>কাজের তালিকা</h3><button onclick="goHome()">হোমে ফিরে যান</button></div>
            <div id="history-page" class="page"><h3>লেনদেন হিস্টরি</h3><button onclick="goHome()">হোমে ফিরে যান</button></div>
            <div id="profile-page" class="page"><h3>প্রোফাইল সেটিং</h3><button onclick="handleLogout()">লগআউট</button></div>
        </div>

        <nav class="bottom-nav">
            <div class="nav-item active" onclick="goHome()"><i class="fas fa-home"></i><span>হোম</span></div>
            <div class="nav-item" onclick="goToPage('task-page')"><i class="fas fa-list-check"></i><span>কাজ</span></div>
            <div class="nav-item" onclick="goToPage('history-page')"><i class="fas fa-history"></i><span>হিস্টরি</span></div>
            <div class="nav-item" onclick="goToPage('profile-page')"><i class="fas fa-user-circle"></i><span>প্রোফাইল</span></div>
        </nav>
    </div>

    <div class="modal-overlay" id="receipt-modal">
        <div class="receipt-card">
            <div style="font-size:50px; color:var(--success); margin-bottom:10px;"><i class="fas fa-check-circle"></i></div>
            <h2 id="r-title" style="margin-bottom:15px;">লেনদেন সফল</h2>
            <div style="background:#f9f9f9; padding:15px; border-radius:15px; text-align:left;">
                <div class="receipt-row"><span>টাইপ:</span><b id="r-type">Deposit</b></div>
                <div class="receipt-row"><span>পরিমাণ:</span><b id="r-amount">৳ 500.00</b></div>
                <div class="receipt-row"><span>তারিখ:</span><b id="r-date">২৫ ডিসে, ২০২৫</b></div>
            </div>
            <button class="auth-btn" style="margin-top:20px; background:#eee; color:#333; box-shadow:none; width:100%; padding:12px; border-radius:12px; border:none;" onclick="closeReceipt()">বন্ধ করুন</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        // ফায়ারবেস কনফিগারেশন
        const firebaseConfig = {
            apiKey: "AIzaSyDSyIjbEj8F8ipbs2wEmaKKTt9OThpX2AM",
            authDomain: "takar-gash.firebaseapp.com",
            projectId: "takar-gash",
            storageBucket: "takar-gash.firebasestorage.app",
            messagingSenderId: "796583669978",
            appId: "1:796583669978:web:9dbd8680e1a98dba30b5e3"
        };
        if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
        const auth = firebase.auth();
        const db = firebase.firestore();

        // স্মার্ট টোস্ট নোটিফিকেশন
        function showToast(msg, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i> <span>${msg}</span>`;
            container.appendChild(toast);
            setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 500); }, 3000);
        }

        // নম্বর ক্যাপচা
        function genCaptcha() {
            const code = Math.floor(1000 + Math.random() * 9000);
            document.getElementById('captcha-code').innerText = code;
        }
        genCaptcha();

        // রিয়েল-টাইম ডাটা সিঙ্ক
        auth.onAuthStateChanged(user => {
            if (user) {
                db.collection('users').doc(user.uid).onSnapshot(doc => {
                    if (doc.exists) {
                        const data = doc.data();
                        document.getElementById('h-user-name').innerText = data.name;
                        document.getElementById('h-user-phone').innerText = data.phone;
                        document.getElementById('bal-value').innerText = "৳ " + (data.balance || 0).toFixed(2);
                        document.getElementById('auth-section').style.display = 'none';
                        document.getElementById('app-body').style.display = 'block';
                    }
                });
            } else {
                document.getElementById('auth-section').style.display = 'flex';
                document.getElementById('app-body').style.display = 'none';
            }
        });

        // অফিস সময় চেক (৯টা-৯:৩০টা)
        function isOfficeOpen() {
            const now = new Date();
            const time = now.getHours() + (now.getMinutes() / 60);
            return time >= 9 && time <= 21.5;
        }

        // নেভিগেশন ও কপি লজিক
        function goToPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            if(id === 'home-page') document.querySelectorAll('.nav-item')[0].classList.add('active');
        }
        function goHome() { goToPage('home-page'); }

        function copyToClipboard(txt) {
            navigator.clipboard.writeText(txt).then(() => showToast("নম্বর কপি হয়েছে!", "success"));
        }

        function revealBalance() {
            document.getElementById('bal-label').style.display = 'none';
            document.getElementById('bal-value').style.display = 'block';
            setTimeout(() => {
                document.getElementById('bal-label').style.display = 'block';
                document.getElementById('bal-value').style.display = 'none';
            }, 3000);
        }

        // সাইন-আপ ও ডিপোজিট
        async function handleSignup() {
            const n = document.getElementById('reg-name').value;
            const ph = document.getElementById('reg-phone').value;
            const em = document.getElementById('reg-email').value;
            const ps = document.getElementById('reg-pass').value;
            const ci = document.getElementById('captcha-input').value;
            const cc = document.getElementById('captcha-code').innerText;

            if (ci !== cc) return showToast("ক্যাপচা ভুল হয়েছে!", "error");
            if (!n || ph.length < 11 || !em || ps.length < 6) return showToast("সব তথ্য সঠিক দিন!", "error");

            try {
                const cred = await auth.createUserWithEmailAndPassword(em, ps);
                await db.collection('users').doc(cred.user.uid).set({ name: n, phone: ph, balance: 0, joinedAt: new Date() });
                showToast("অ্যাকাউন্ট তৈরি সফল! ✅", "success");
            } catch (e) { showToast(e.message, "error"); }
        }

        async function submitDeposit() {
            if (!isOfficeOpen()) return showToast("অফিস এখন বন্ধ! (৯টা-৯:৩০টা)", "error");
            const amt = Number(document.getElementById('dep-amt').value);
            const trx = document.getElementById('dep-trx').value;
            if (amt < 100 || !trx) return showToast("সঠিক তথ্য দিন!", "error");
            
            await db.collection('transactions').add({ uid: auth.currentUser.uid, type: 'deposit', amount: amt, trxID: trx, status: 'pending', createdAt: new Date() });
            showToast("রিকোয়েস্ট সফল! এডমিন চেক করবে। ✅", "success");
            goHome();
        }

        function openSupport() { window.open("https://t.me/TAKAR_GACH_V27", "_blank"); }
        function handleLogout() { auth.signOut(); }
        function closeReceipt() { document.getElementById('receipt-modal').style.display = 'none'; }
    </script>
</body>
</html>
